<!DOCTYPE html>
<html lang="en">
<head>
  <title>Form</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
 Â <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <script src="https://kit.fontawesome.com/473e8f3a80.js" crossorigin="anonymous"></script>
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
  <script src="https://unpkg.com/@zxing/library@0.15.2/umd/index.min.js"></script>
</head>
<body>
<div class="container">
  <h2>Location Survey:</h2>
  <form action="http://httpbin.org/post" method="POST">
  <div class="form-group">
      <label for="Roll No"><b>SCAN BAR CODE:</b></label><br>
      <canvas class="frame" height="250" width="250" style="border-radius: 10px;"></canvas><br>
      <input type="hidden" name="rno" id="rno">
      <label for="Roll No"><b>Name:</b></label>
      <input type="text" class="form-control" placeholder="Enter Name" name="name" autocomplete="name" required><br>
      <label for="Roll No"><b>Address:</b></label>
      <div class="input-group mb-3">
      <input type="text" id="add" class="form-control" placeholder="Address" aria-describedby="basic-addon2" name="address" autocomplete="street-address">
      <div class="input-group-append">
      <span class="input-group-text" id="basic-addon2" onclick="track()"><i class="fas fa-compass" style="font-size:24px;"></i></span>
      </div>
      </div>
      <div class="g-recaptcha" data-sitekey="6LdHa8kUAAAAAGQAL3XynkQfHxP9xo1mRCKUn0BS" data-callback="save"></div><br>
    </div>
    </form>
</div>
</body>
<script>
if(location.search!=="") {alert(location.search.split("?err=").reverse()[0])}
var rno;
var loc = {lat: "", lon: ""};
function track() {
navigator.geolocation.getCurrentPosition(function(pos) {
loc.lat=pos.coords.latitude;
loc.lon=pos.coords.longitude;
document.querySelector("#add").value=pos.coords.latitude + "," + pos.coords.longitude;
});
}
function save() {
document.forms[0].submit();
}
var video = document.createElement("video");
video.setAttribute("autoplay","true");
var canvas = document.querySelector(".frame");
navigator.mediaDevices.getUserMedia({video: { facingMode: { exact: "environment" } } }).then(function(stream) {
video.srcObject = stream;
});
var ctr = setInterval(function() {canvas.getContext("2d").drawImage(video, 0, 0, 250, 250)},0)
canvas.onclick = function() {
document.querySelector("#rno").setAttribute("value",canvas.toDataURL());
const codeReader = new ZXing.BrowserBarcodeReader();
clearInterval(ctr);
codeReader.decodeFromImage(undefined,canvas.toDataURL()).then(result => {
console.log(result);
alert(result.text);
}).catch(err => {
console.error(err);
alert(err);
});
navigator.mediaDevices.getUserMedia({video: { facingMode: { exact: "environment" } } }).then(function(stream) {
stream.getTracks().forEach(function(track) {track.stop();});
});
}
</script>
</html>

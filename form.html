<!DOCTYPE html>
<html lang="en">
<head>
  <title>Form</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
 Â <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <script src="https://kit.fontawesome.com/473e8f3a80.js" crossorigin="anonymous"></script>
</head>
<body>
<div class="container">
  <h2>Location Survey:</h2>
  <form>
    <div class="form-group">
      <label for="Roll No"><b>SCAN BAR CODE:</b></label><br>
      <canvas class="frame" style="height: 250px; width: 250px;"></canvas>
      <label for="Roll No"><b>Roll No.:</b></label>
      <input type="text" class="form-control" placeholder="Enter Roll Number" onblur="getdata(this.value)">
    </div>
      </form>
<button onclick="track()" class="btn btn-primary"><i class="fas fa-compass" style="font-size:24px;"></i> Get Location</button>
<button onclick="save()" class="btn btn-primary" id="submit" style="display: none;">Submit</button>
<p id="data" style="padding: 10 10 10 10; font-size: 24px;"><p>
</div>
</body>
<script>
var rno;
var loc = {lat: "", lon: ""};
function getdata(x) {
rno = x;
fetch("https://theabbie.github.io/files/details.json").then(l=>l.json()).then(function(p) {
Object.keys(p[x.slice(-2)]).forEach(function(t) {
document.querySelector("#data").innerHTML+=`<b>${t}:</b> ${p[x.slice(-2)][t]}<br>`
})
})
}
function track() {
navigator.geolocation.getCurrentPosition(function(pos) {
loc.lat=pos.coords.latitude;
loc.lon=pos.coords.longitude;
document.querySelector("#data").innerHTML+=("<b>Your current coordinates:</b><br>"+pos.coords.latitude + "," + pos.coords.longitude);
});
document.querySelector("#submit").style.display="inline";
}
function save() {
fetch("https://thedb.now.sh/location/"+rno+"?data="+loc.lat+","+loc.lon).then(function(l) {
alert("Thank you, your response has been recorded");
})
}
var video = document.createElement("video");
video.setAttribute("autoplay","true");
var canvas = document.querySelector(".frame");
navigator.mediaDevices.getUserMedia({video: { facingMode: { exact: "environment" } } }).then(function(stream) {
video.srcObject = stream;
});
setInterval(function() {canvas.getContext("2d").drawImage(video, 0, 0, 250, 250)},0)
canvas.onclick = function() {
alert(canvas.toDataURL());
}
</script>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <title>Form</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <script src="https://kit.fontawesome.com/473e8f3a80.js" crossorigin="anonymous"></script>
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
  <script src="https://unpkg.com/@zxing/library@0.15.2/umd/index.min.js"></script>
</head>
<body>
<div class="container">
  <h2>Location Survey:</h2>
  <form action="https://script.google.com/macros/s/AKfycbz-wX1PFOaVYNX7_Zxgn1eiiELSZVw4bdnekKEIiwDRg84xKduG/exec" method="POST">
  <div class="form-group">
      <label for="rno"><b>SCAN BAR CODE:</b></label><br>
      <canvas class="frame" height="250" width="250" style="border-radius: 10px;"></canvas><br>
      <input type="hidden" name="rno" id="rno">
      <label for="name"><b>Name:</b></label>
      <div class="input-group">
      <input type="text" class="form-control" placeholder="Enter Name" name="name" autocomplete="name" required><br>
      <div class="input-group-append">
        <span class="input-group-text" onclick='document.querySelector("#gender").setAttribute("value","M")'><i class="fas fa-mars" style="font-size:24px;"></i></span>
        <span class="input-group-text" onclick='document.querySelector("#gender").setAttribute("value","F")'><i class="fas fa-venus" style="font-size:24px;"></i></span>
      </div>
      </div>
      <input type="hidden" name="gender" id="gender">
      <label for="address"><b>Address:</b></label>
      <div class="input-group mb-3">
      <input type="text" id="add" class="form-control" placeholder="Address" aria-describedby="basic-addon2" name="address" autocomplete="street-address">
      <div class="input-group-append">
      <span class="input-group-text" id="basic-addon2" onclick="track()"><i class="fas fa-compass" style="font-size:24px;"></i></span>
      </div>
      </div>
      <label for="mail"><b>Email ID:</b></label>
      <input type="email" class="form-control" placeholder="Enter Email ID" name="mail" autocomplete="email" required><br>
      <label for="dob"><b>Date Of Birth:</b></label>
      <input type="date" class="form-control" placeholder="Enter Date of Birth" name="dob" autocomplete="date" required><br>
      <div class="g-recaptcha" data-sitekey="6LdHa8kUAAAAAGQAL3XynkQfHxP9xo1mRCKUn0BS" data-callback="save"></div><br>
    </div>
    </form>
</div>
</body>
<script>
const codeReader = new ZXing.BrowserMultiFormatReader();

if(location.search!=="") {alert(location.search.split("?err=").reverse()[0])}

var rno;
var loc = {lat: "", lon: ""};

document.querySelectorAll(".input-group-text").forEach(function(x) {
x.addEventListener("click", function() {x.style.background="cyan";})
})

function track() {
navigator.geolocation.getCurrentPosition(function(pos) {
loc.lat=pos.coords.latitude;
loc.lon=pos.coords.longitude;
document.querySelector("#add").value=pos.coords.latitude + "," + pos.coords.longitude;
});
}

function save() {
document.forms[0].submit();
}

var video = document.createElement("video");
video.setAttribute("autoplay","true");
var canvas = document.querySelector(".frame");

navigator.mediaDevices.getUserMedia({video: { facingMode: { exact: "environment" } } }).then(function(stream) {
video.srcObject = stream;
var ctr = setInterval(function() {canvas.getContext("2d").drawImage(video, 0, 0, 250, 250)},0)

canvas.addEventListener("click", function() {
stream.getVideoTracks()[0].applyConstraints({advanced: [{torch: true}]});
});

codeReader.decodeFromInputVideoDevice(undefined, video).then(function(result) {
alert(result.text)
document.querySelector("#rno").setAttribute("value",result.text);
clearInterval(ctr);
}).catch(err => alert(err));
});
</script>
</html>

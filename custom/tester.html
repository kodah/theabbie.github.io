<html>
<head>
<title>
Chatter
</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://www.gstatic.com/firebasejs/5.4.1/firebase.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<style>
@media only screen and (max-width: 728px) {
    .button {width: 100%;}
    .text,.reply {width: 50%; height: 25px;}
}
@keyframes appear-right {0% {left: 25%;}100% {left: 0px;}}
@keyframes appear-left {0% {right: 25%;}100% {right: 0px;}}
* {letter-spacing: 3px; line-height: 150%;word-spacing: 70%;}
body {margin: 0 0 0 0; background-color: cadetblue;}
chatbox {width: 65%; position: relative; margin: auto; padding: 0 40 0 40; display: block; background-color: darkseagreen; height: 10000%;}
qbox {display: block; position: relative; float: right; padding: 10 10 10 10; background-color: greenyellow; font-family: century gothic; font-size: 20px; word-break: break-all; max-width: 40%; max-height: 115px; overflow: hidden;}
abox {display: none; position: relative; float: left; padding: 10 10 10 10; background-color: orange; font-family: century gothic; font-size: 20px; word-break: break-all; max-width: 40%; max-height: 115px; overflow: hidden;}
type {display: block; position: fixed;  padding: 0 0 0 0; bottom: 0px; float: none;}
.text, .reply {padding: 20 20 20 20; font-family: century gothic; font-size: 20px; position: relative; float: left; border: 0px; display: block; border-left: 1px solid gray;}
.button {padding: 20 20 20 20; background-color: slateblue; border: 0px; color: white; font-size: 20px; position: relative; float: left;}
qbox:first-of-type {animation: appear-right 1s 1;}
abox:first-of-type {animation: appear-left 1s 1;}
</style>
</head>
<body>
<chatbox>
</chatbox>
<type>
<input type="text" class="text">
<input type="text" class="reply">
<input type="button" class="button" onclick="chatter()" value="Send">
</type>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyCSZXklwVQpA0HBLSsJuYDeqEQfGlE8m5Y",
    authDomain: "chattterrr.firebaseapp.com",
    databaseURL: "https://chattterrr.firebaseio.com",
    projectId: "chattterrr",
    storageBucket: "chattterrr.appspot.com",
    messagingSenderId: "213252919279"
  };
  firebase.initializeApp(config);
document.getElementsByTagName("type")[0].addEventListener("keydown", function (e) {if (e.keyCode === 13) {chatter();}});
document.getElementsByClassName("text")[0].addEventListener("keydown", function (e) {if (e.keyCode === 39) {document.getElementsByClassName("reply")[0].focus()}});
document.getElementsByClassName("reply")[0].addEventListener("keydown", function (e) {if (e.keyCode === 37) {document.getElementsByClassName("text")[0].focus()}});
var p;
var talkstore = {};
var chats = firebase.database().ref('chats');
var chatdata = firebase.database().ref('chatdata');
chats.on('value', gotchats);
function gotchats(data) {document.getElementsByTagName("chatbox")[0].innerHTML = data.val();}
chatdata.on('value',function(data) {talkstore = Object.assign({}, data.val());});
function chatter() {
var q = document.getElementsByClassName("text")[0].value;
var a = document.getElementsByClassName("reply")[0].value;
if (talkstore[q]==undefined) {talkstore[q]=[];}
if (a!="" && talkstore[q].indexOf(a)==-1) {talkstore[q] = talkstore[q].concat(a.split(","));}
console.log(talkstore);
var init = "<br><br>" + document.getElementsByTagName("chatbox")[0].innerHTML;
if (talkstore[q][Math.floor(talkstore[q].length*Math.random())]==undefined) {
$.get("https://www.googleapis.com/customsearch/v1?key=AIzaSyBuGPR35RhD8C6Phwv6Z9IAREI5paLoFAw&cx=005734029147097694460:pwge8by1pko&q="+q, function(data, status){
    document.getElementsByTagName("chatbox")[0].innerHTML = "<br><qbox>" + q + "</qbox>" + "<abox>" + data.items[0].htmlSnippet + "</abox><br><br><br>" + init;
});
}
else {document.getElementsByTagName("chatbox")[0].innerHTML = "<br><qbox>" + q + "</qbox>" + "<abox>" + talkstore[q][Math.floor(talkstore[q].length*Math.random())] + "</abox><br><br><br>" + init;}
chatdata.set(talkstore);
chats.set(document.getElementsByTagName("chatbox")[0].innerHTML);
setTimeout(function() {document.getElementsByTagName("abox")[0].style.display="block";},1500)
}
</script>
</body>
</html>